class Loader{constructor(a){const b={'CTUnknown':0x0,'CTGeneralBinaryBlock':0x1,'CTStructure':0x2,'CTMeshBlock':0x3,'CTClashTestData':0x4,'CTImageData':0x5,'CTImageIdxTable':0x6,'CTMeshBlockTable':0x7,'CTEntityBinaryBlock':0x8,'CTBodyMeshData':0x9,'CTPropDic':0xa,'CTUserDefGroups':0xb,'CTFileMetaData':0xc,'CTAuthority':0xd,'CTNodePropTable':0xe,'CTNodePropTableIndices':0xf,'CTInitialInfo':0x10,'CTUserCustom':0x11,'CTEdgeTable':0x12,'CTThumbnail':0x13,'CTMisc':0x14,'CTStructureHeader':0x15,'CTMeshBlockSub':0x16,'CTStructureNameData':0x18,'CTSplitStructureMeshBlockFile':0x22,'CTSplitAreaMeshBlockList':0x23,'CTTreeInfo':0x26,'CTStructureFileInfoBlock':0x27,'CTMeshFileInfoBlock':0x28},c={'None':0x0,'Split':0xa,'Structure':0x14,'Structure_Tree':0x15,'Property':0x1e,'MeshBlock_New':0x28,'MeshBlock_Update':0x29,'MeshBlock_LOD':0x2a,'Header':0x64};let d=this,e=function(){let w={'typeStr':null,'version':null,'sizeTocItem':null,'nToc':null,'tocPos':null};return w;},f=function(){let w={'version':null,'datatype':null,'structure_cnt':null,'mesh_cnt':null,'property_cnt':null,'unit':null};return w;};this['parsetype']=0x0;function g(w){try{return decodeURIComponent(escape(w));}catch(x){return w;}}function h(w,x,y){const z=w['getUint32'](x,y),A=w['getUint32'](x+0x4,y),B=y?z+0x2*0x20*A:0x2*0x20*z+A;return B;}function i(w){let x='',y={'dom':/(http(s)?:\/\/|www.)([a-z0-9\w]+\.*)+[a-z0-9]{2,4}\//gi,'par':/(http(s)?:\/\/|www.)([a-z0-9\w]+\.*)+[a-z0-9]{2,4}([\/a-z0-9-%#?&=\w])+(\.[a-z0-9]{2,4}(\?[\/a-z0-9-%#?&=\w]+)*)*/gi};w['replace'](y['dom'],function(C){x=C;});let z=w['replace'](y['dom'],''),A=encodeURIComponent(z),B=x+A;return B;}function j(w,x,y,z){$['ajax']({'complete':function(){y(0x0,0x1);},'url':i(w['Url']),'type':'GET','beforeSend':function(){y(0x0,0x0,0x0,0x0);},'xhr':function(){let A=this,B=$['ajaxSettings']['xhr']();return B['responseType']='arraybuffer',B['onprogress']=function(C){let D=C['loaded']/C['total'];y(0x0,D,C['loaded'],C['total']);},B['addEventListener']('load',function(){let C=$()['jquery'],D=C['split']('.'),E=D[0x0]*0x1,F=D[0x1]*0x1;if(E<=0x2&&F<0x2)A['success'](B['response']);}),B;},'responseType':'arraybuffer','processData':![],'async':!![],'success':function(A){z(A,w),A=null;},'error':function(A,B,C){console['log'](A['status']),console['log'](C);}});}function k(w,x,y,z){y(0x0,0x0,0x0,0x0);let A=new XMLHttpRequest();A['open']('GET',w['Url'],!![]),A['responseType']='arraybuffer',A['onload']=function(B){A['status']===0xc8?z(A['response'],w):console['log'](A['statusText']);},A['send'](null);}function l(w,x,y){let z=[];for(let A=0x0;A<w;A++){let B=x['tocPos']+0xc+A*x['sizeTocItem'],C=y['getInt32'](B,!![]);B+=0x8;let D=h(y,B,!![]);B+=0x8;let E=y['getUint32'](B,!![]);B+=0x4;let F=y['getUint32'](B,!![]);B+=0x4;let G=0x0;d['parsetype']===0x1&&(G=y['getUint32'](B,!![]),B+=0x4);let H={'itemType':C,'position':D,'datasize':E,'uncompsize':F,'parsetype':G};z['push'](H);}return z;}function m(w,x){let y=-0x1;for(let z=x['length']-0x1;z>=0x0;z--){if(x[z]['itemType']===w){y=z;break;}}return y;}function n(w){if(w['DataType']===c['None']||w['DataType']===c['MeshBlock_New'])return!![];else return![];}function o(w,x){try{if(w===undefined)return undefined;let y=w['position'],z;return x===undefined?(z=new DataView(result,y,w['datasize']),z):(z=new DataView(x,y,w['datasize']),z);}catch(A){return undefined;}}function p(w,x){let y=0x0,z;z=w['getInt32'](y,!![]),y+=0x4;let A=0x0;for(let B=0x0;B<z;B++){let C=new VIZCore['Color']();C['r']=w['getUint8'](y,!![]),C['g']=w['getUint8'](y+0x1,!![]),C['b']=w['getUint8'](y+0x2,!![]),C['a']=w['getUint8'](y+0x3,!![]),y+=0x4;let D=w['getUint32'](y,!![]);y+=0x4;let E=w['getUint32'](y,!![]);y+=0x4;let F=w['getUint32'](y,!![]);y+=0x4;if(d['parsetype']===0x1){let P=w['getUint32'](y,!![]);y+=0x4;}let G=D/0xf,H=new Float32Array(w['buffer'],y+w['byteOffset'],D);y+=D*0x4;let I=new Float32Array(w['buffer'],y+w['byteOffset'],E);y+=E*0x4;let J=new Uint32Array(w['buffer'],y+w['byteOffset'],F);y+=F*0x4;let K=w['getUint32'](y,!![]);y+=0x4;let L=[],M=[],N=0x0,O;for(let Q=0x0;Q<K;Q++){let R=w['getUint32'](y,!![]);y+=0x4;let S=w['getUint32'](y,!![]);y+=0x4,R=R+a['Data']['GetStartID'](x['ID']),S=S+a['Data']['GetStartID'](x['ID']);let T=w['getUint32'](y,!![]);y+=0x4;let U=w['getUint32'](y,!![]);y+=0x4;let V=w['getUint16'](y,!![]);y+=0x2;let W=w['getUint16'](y,!![]);y+=0x2;let X=new Float32Array(w['buffer'],y+w['byteOffset'],0x6);y+=0x18;let Y={'partId':R,'bodyId':S,'color':C,'m_vnIdx':T*0x3,'m_triIdx':U*0x3,'m_nVtx':V*0x3,'m_nTris':W*0x3,'BBox':new VIZCore['BBox'](X),'action':{'visible':!![],'selection':![],'transform':new VIZCore['Matrix4']()},'colorIdx':null,'object':null};a['Data']['ObjectMap']['has'](x['Url'])?O=a['Data']['ObjectMap']['get'](x['Url'])[A]:O=a['Data']['Object3D']();{a['Data']['IDColor']['new'](),Y['colorIdx']=a['Data']['IDColor']['r']+(a['Data']['IDColor']['g']<<0x8)+(a['Data']['IDColor']['b']<<0x10)+a['Data']['IDColor']['a']*0x1000000;let Z=Y['m_nVtx']/0x3*0x4;for(let a0=0x0;a0<Z;a0=a0+0x4){M[N+a0+0x0]=a['Data']['IDColor']['r'],M[N+a0+0x1]=a['Data']['IDColor']['g'],M[N+a0+0x2]=a['Data']['IDColor']['b'],M[N+a0+0x3]=a['Data']['IDColor']['a'];}N+=Z,L['push'](Y);}}O['index']=A,O['attribs']['a_index']['array']=J,O['numElements']=O['attribs']['a_index']['array']['length'],O['attribs']['a_position']['array']=H,O['attribs']['a_normal']['array']=I;if(!a['Data']['ObjectMap']['has'](x['Url'])){for(let a1=0x0;a1<L['length'];a1++){L[a1]['object']=O,a['Data']['AddBody'](L[a1]);}O['attribs']['a_color']['array']=new Uint8Array(M,0x0,N),a['Data']['Objects']['push'](O),O['tag']=L,O['flag']['lod']=x['DataType'],O['link']=x['Url'];}if(x['DataType']===c['MeshBlock_LOD']){let a2=a['Data']['LODMap']['get'](x['Url']);a2===undefined?(a2=[],a2['push'](O),a['Data']['LODMap']['set'](x['Url'],a2)):(a2['push'](O),a['Data']['LODMap']['set'](x['Url'],a2));if(a['DataSplit']!==0x0){let a3=a['Data']['ObjectMap']['get'](x['Url']);a3===undefined?(a3=[],a3['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a3)):(a3['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a3));}}else{if(a['DataSplit']!==0x0){let a4=a['Data']['ObjectMap']['get'](x['Url']);a4===undefined?(a4=[],a4['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a4)):(a4['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a4));}}A++;}}function q(w,x){let y=0x0,z;z=w['getInt32'](y,!![]),y+=0x4;let A=0x0,B=!![],C=a['Data']['ModelFileManager']['GetFileDataInfoItem'](x['Key'],x['Url'],VIZCore['Enum']['FILEINFOTYPE']['MESH']);C!==undefined&&C['Download']&&(B=![]);for(let D=0x0;D<z;D++){let E=new VIZCore['Color']();E['r']=w['getUint8'](y,!![]),E['g']=w['getUint8'](y+0x1,!![]),E['b']=w['getUint8'](y+0x2,!![]),E['a']=w['getUint8'](y+0x3,!![]),y+=0x4;let F=w['getUint32'](y,!![]);y+=0x4;let G=w['getUint32'](y,!![]);y+=0x4;let H=w['getUint32'](y,!![]);y+=0x4;if(d['parsetype']===0x1){let R=w['getUint32'](y,!![]);y+=0x4;}let I=F/0xf,J=new Float32Array(w['buffer'],y+w['byteOffset'],F);y+=F*0x4;let K=new Float32Array(w['buffer'],y+w['byteOffset'],G);y+=G*0x4;let L=new Uint32Array(w['buffer'],y+w['byteOffset'],H);y+=H*0x4;let M=w['getUint32'](y,!![]);y+=0x4;let N=[],O=[],P=0x0,Q;if(!B){let S=a['Data']['ModelFileManager']['GetFileAreaData'](x['Key'],x['Url']);Q=S['objects'][A],Q['flag']['updateProcess']=!![];}else Q=a['Data']['Object3D']();if(B){for(let T=0x0;T<M;T++){let U=w['getUint32'](y,!![]);y+=0x4;let V=w['getUint32'](y,!![]);y+=0x4,U=U+a['Data']['GetStartID'](x['ID']),V=V+a['Data']['GetStartID'](x['ID']);let W=w['getUint32'](y,!![]);y+=0x4;let X=w['getUint32'](y,!![]);y+=0x4;let Y=w['getUint16'](y,!![]);y+=0x2;let Z=w['getUint16'](y,!![]);y+=0x2;let a0=new Float32Array(w['buffer'],y+w['byteOffset'],0x6);y+=0x18;let a1={'partId':U,'bodyId':V,'color':E,'m_vnIdx':W*0x3,'m_triIdx':X*0x3,'m_nVtx':Y*0x3,'m_nTris':Z*0x3,'BBox':new VIZCore['BBox'](a0),'action':{'visible':!![],'selection':![],'transform':new VIZCore['Matrix4']()},'colorIdx':null,'object':null};if(a['useTree']){let a2=a['Tree']['GetNode'](a1['bodyId']);a2!==undefined&&(a1['action']['visible']=a2['visible'],a1['action']['selection']=a2['selection']);}{a['Data']['IDColor']['new'](),a1['colorIdx']=a['Data']['IDColor']['r']+(a['Data']['IDColor']['g']<<0x8)+(a['Data']['IDColor']['b']<<0x10)+a['Data']['IDColor']['a']*0x1000000;let a3=a1['m_nVtx']/0x3*0x4;for(let a4=0x0;a4<a3;a4=a4+0x4){O[P+a4+0x0]=a['Data']['IDColor']['r'],O[P+a4+0x1]=a['Data']['IDColor']['g'],O[P+a4+0x2]=a['Data']['IDColor']['b'],O[P+a4+0x3]=a['Data']['IDColor']['a'];}P+=a3,N['push'](a1);}}{for(let a5=0x0;a5<N['length'];a5++){N[a5]['object']=Q,a['Data']['AddBody'](N[a5]);}Q['attribs']['a_color']['array']=new Uint8Array(O,0x0,P),a['Data']['Objects']['push'](Q),Q['tag']=N,Q['flag']['lod']=x['DataType'],Q['link']=x['Url'];}}else{for(let a6=0x0;a6<M;a6++){y+=0x4,y+=0x4,y+=0x4,y+=0x4,y+=0x2,y+=0x2,y+=0x18;let a7=Q['tag'][a6];{let a8,a9,aa,ab;a8=a7['colorIdx']%0x100,a9=Math['floor'](a7['colorIdx']/0x100)%0x100,aa=Math['floor'](Math['floor'](a7['colorIdx']/0x100)/0x100)%0x100,ab=Math['floor'](Math['floor'](Math['floor'](a7['colorIdx']/0x100)/0x100)/0x100)%0x100;let ac=a7['m_nVtx']/0x3*0x4;for(let ad=0x0;ad<ac;ad=ad+0x4){O[P+ad+0x0]=a8,O[P+ad+0x1]=a9,O[P+ad+0x2]=aa,O[P+ad+0x3]=ab;}P+=ac;}}Q['attribs']['a_color']['array']=new Uint8Array(O,0x0,P);}Q['index']=A,Q['link']=x['Url'],Q['attribs']['a_index']['array']=L,Q['numElements']=Q['attribs']['a_index']['array']['length'],Q['attribs']['a_position']['array']=J,Q['attribs']['a_normal']['array']=K;if(B){let ae=a['Data']['ModelFileManager']['GetFileAreaData'](x['Key'],x['Url']);ae['objects']['push'](Q);}A++;}}function r(w,x){let y=0x0,z;z=w['getInt32'](y,!![]),y+=0x4;let A=0x0;for(let B=0x0;B<z;B++){let C=new VIZCore['Color']();C['r']=w['getUint8'](y,!![]),C['g']=w['getUint8'](y+0x1,!![]),C['b']=w['getUint8'](y+0x2,!![]),C['a']=w['getUint8'](y+0x3,!![]),y+=0x4;let D=w['getUint32'](y,!![]);y+=0x4;let E=w['getUint32'](y,!![]);y+=0x4;let F=w['getUint32'](y,!![]);y+=0x4;if(d['parsetype']===0x1){let P=w['getUint32'](y,!![]);y+=0x4;}let G=D/0xf,H=new Float32Array(w['buffer'],y+w['byteOffset'],D);y+=D*0x4;let I=new Float32Array(w['buffer'],y+w['byteOffset'],E);y+=E*0x4;let J=new Uint32Array(w['buffer'],y+w['byteOffset'],F);y+=F*0x4;let K=w['getUint32'](y,!![]);y+=0x4;let L=[],M=[],N=0x0,O;for(let Q=0x0;Q<K;Q++){let R=w['getUint32'](y,!![]);y+=0x4;let S=w['getUint32'](y,!![]);y+=0x4,R=R+a['Data']['GetStartID'](x['ID']),S=S+a['Data']['GetStartID'](x['ID']);let T=w['getUint32'](y,!![]);y+=0x4;let U=w['getUint32'](y,!![]);y+=0x4;let V=w['getUint16'](y,!![]);y+=0x2;let W=w['getUint16'](y,!![]);y+=0x2;let X=new Float32Array(w['buffer'],y+w['byteOffset'],0x6);y+=0x18;let Y={'partId':R,'bodyId':S,'color':C,'m_vnIdx':T*0x3,'m_triIdx':U*0x3,'m_nVtx':V*0x3,'m_nTris':W*0x3,'BBox':new VIZCore['BBox'](X),'action':{'visible':!![],'selection':![],'transform':new VIZCore['Matrix4']()},'colorIdx':null,'object':null};O=a['Data']['Object3D']();{a['Data']['IDColor']['new'](),Y['colorIdx']=a['Data']['IDColor']['r']+(a['Data']['IDColor']['g']<<0x8)+(a['Data']['IDColor']['b']<<0x10)+a['Data']['IDColor']['a']*0x1000000;let Z=Y['m_nVtx']/0x3*0x4;for(let a0=0x0;a0<Z;a0=a0+0x4){M[N+a0+0x0]=a['Data']['IDColor']['r'],M[N+a0+0x1]=a['Data']['IDColor']['g'],M[N+a0+0x2]=a['Data']['IDColor']['b'],M[N+a0+0x3]=a['Data']['IDColor']['a'];}N+=Z,L['push'](Y);}}O['index']=A,O['attribs']['a_index']['array']=J,O['numElements']=O['attribs']['a_index']['array']['length'],O['attribs']['a_position']['array']=H,O['attribs']['a_normal']['array']=I;{for(let a1=0x0;a1<L['length'];a1++){L[a1]['object']=O,a['Data']['AddBody'](L[a1]);}O['attribs']['a_color']['array']=new Uint8Array(M,0x0,N),a['Data']['Objects']['push'](O),O['tag']=L,O['flag']['lod']=x['DataType'],O['link']=x['Url'];}if(x['DataType']===c['MeshBlock_LOD']){let a2=a['Data']['LODMap']['get'](x['Url']);a2===undefined?(a2=[],a2['push'](O),a['Data']['LODMap']['set'](x['Url'],a2)):(a2['push'](O),a['Data']['LODMap']['set'](x['Url'],a2));}else{if(a['DataSplit']!==0x0){let a3=a['Data']['ObjectMap']['get'](x['Url']);a3===undefined?(a3=[],a3['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a3)):(a3['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a3));}}A++;}}function s(w,x,y,z,A){if(w['Status']===0x3){let E=a['Data']['ModelFileManager']['GetFileAreaData'](w['Key'],w['Url']);E!==undefined?z(E['objects'],w):z(undefined,w);return;}let B=m(b['CTMeshBlock'],x),C=x[B],D=o(C,y);if(C!==undefined)setTimeout(function(){let F=0x0,G=D['getInt32'](F,!![]);F+=0x4;let H=0x0,I=function(){for(let J=H;J<G;J++){if(w['Crash']||w['Status']===0x3)break;let K=H/G;if(K===Infinity)K=0x0;let L=0x0;L=D['getInt32'](F,!![]),F+=0x4,toc=x[L];let M=o(toc,y);if(w['DataType']===c['MeshBlock_LOD'])q(M,w);else r(M,w);H++;if(H!==G){setTimeout(function(){I();},0x1);break;}else setTimeout(function(){let N=a['Data']['ModelFileManager']['GetFileAreaData'](w['Key'],w['Url']);N!==undefined?z(N['objects'],w):z(undefined,w);},0x1);}if(w['Crash']||w['Status']===0x3){let N=a['Data']['ModelFileManager']['GetFileAreaData'](w['Key'],w['Url']);N!==undefined?z(N['objects'],w):z(undefined,w);}};setTimeout(function(){if(!a['useFramebuffer'])A(0x1,0x0);I();},0x1);},0x1);else{let F=a['Data']['ModelFileManager']['GetFileAreaData'](w['Key'],w['Url']);F!==undefined?z(F['objects'],w):z(undefined,w);}}function t(w,x,y,z){let A=m(b['CTTreeInfo'],x),B=x[A],C=o(B,y),D=m(b['CTStructure'],x),E=x[D],F=o(E,y),G=m(b['CTStructureNameData'],x),H=x[G],I=o(H,y);if(z!==undefined)z(w,C,F,I);}function u(w,x,y,z){let A=m(b['CTSplitStructureMeshBlockFile'],x),B=x[A],C=o(B,y),D=0x0,E=new Int32Array(C['buffer'],D+C['byteOffset'],0x6),F=f();F['version']=E[0x0],F['datatype']=E[0x1],F['structure_cnt']=E[0x2],F['mesh_cnt']=E[0x3],F['property_cnt']=E[0x4],F['unit']=E[0x5],a['Data']['Accumulation']=F['unit'],D=0x0;let G=[],H=m(b['CTStructureFileInfoBlock'],x),I=x[H],J=o(I,y);for(let O=0x0;O<F['structure_cnt'];O++){let P=J['getInt32'](D,!![]);D+=0x4;let Q=new Uint8Array(J['buffer'],J['byteOffset']+D,P),R=String['fromCharCode']['apply'](null,Q);R=g(R);let S=a['Data']['GetPath'](w['Url']);G['push'](S+R);}D=0x0;let K=[],L=m(b['CTMeshFileInfoBlock'],x),M=x[L],N=o(M,y);for(let T=0x0;T<F['mesh_cnt'];T++){let U=N['getInt32'](D,!![]);D+=0x4;let V=new Uint8Array(N['buffer'],N['byteOffset']+D,U);D+=U;let W=String['fromCharCode']['apply'](null,V);W=g(W);let X=N['getInt32'](D,!![]);D+=0x4;let Y=N['getInt32'](D,!![]);D+=0x4;let Z=N['getInt32'](D,!![]);D+=0x4;let a0=N['getInt32'](D,!![]);D+=0x4;let a1=N['getFloat32'](D,!![]);D+=0x4;let a2=N['getFloat32'](D,!![]);D+=0x4;let a3=N['getFloat32'](D,!![]);D+=0x4;let a4=N['getFloat32'](D,!![]);D+=0x4;let a5=N['getFloat32'](D,!![]);D+=0x4;let a6=N['getFloat32'](D,!![]);D+=0x4;let a7=N['getFloat32'](D,!![]);D+=0x4;let a8=N['getFloat32'](D,!![]);D+=0x4;let a9=N['getInt32'](D,!![]);D+=0x4,V=new Uint8Array(N['buffer'],N['byteOffset']+D,a9),D+=a9;let aa=String['fromCharCode']['apply'](null,V);aa=g(aa);let ab=[],ac=[];ac[0x0]=a3,ac[0x1]=a4,ac[0x2]=a5,ac[0x3]=a6,ac[0x4]=a7,ac[0x5]=a8;let ad=a['Data']['GetPath'](w['Url']),ae=ad+W,af=[];af['push'](ae);let ag={'bbox':new VIZCore['BBox'](ac),'list':af,'lod':X,'lod_sequence':T,'file':ae,'tri_num':a0,'area':a1,'area_num':a2,'index_start':Y,'index_end':Z};ab['push'](ag),K['push'](ab);}z(w,G,K);}function v(w,x,y,z){let A=new DataView(w),B=0x0,C=e(),D=new Uint8Array(w,B,0x10);C['typeStr']=String['fromCharCode']['apply'](null,D),B+=0x10,C['version']=A['getInt32'](B,!![]),B+=0x4,C['sizeTocItem']=A['getInt32'](B,!![]),B+=0x4,C['nToc']=A['getInt32'](B,!![]),B+=0x4,C['tocPos']=h(A,B,!![]),B+=0x8;let E=0x0,F=0x0,G=C['tocPos'];E=A['getInt32'](G,!![]),G+=0x4,F=h(A,G,!![]),G+=0x8;let H=[];H=l(E,C,A),x['DataType']===c['Header']&&u(x,H,w,y),x['DataType']===c['Structure_Tree']&&t(x,H,w,y),x['DataType']===c['MeshBlock_LOD']&&s(x,H,w,y,z);}this['Load']=function(w,x,y){d['Download'](w,x,y);},this['Download']=function(w,x,y){let z=x,A=y;function B(C,D){v(C,D,z,A);}k(w,z,A,B);};}}export default Loader;